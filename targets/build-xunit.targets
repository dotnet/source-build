<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <UsingTask AssemblyFile="$(TaskDirectory)Microsoft.DotNet.SourceBuild.Tasks/bin/Debug/netstandard1.4/Microsoft.DotNet.SourceBuild.Tasks.dll" TaskName="WriteVersionsFile" />

  <!--
    =======================================================================================================
                                         XUnit Targets
    =======================================================================================================
    
  -->

  <Target Name="_InitializeXunit">
    <FindInList CaseSensitive="false" List="@(Repository)" ItemSpecToFind="xunit">
      <Output TaskParameter="ItemFound" ItemName="XUnit" />
    </FindInList>

    <Error Condition="'%(XUnit.ProjectDirectory)' == ''" Text="You are missing XUnit metadata, or you need to specify a XUnit build directory, either with the /p:PathToXUnit switch, or in the 'targets/target.metadata'" />

    <PropertyGroup>
      <XUnitDirectory>%(XUnit.ProjectDirectory)</XUnitDirectory>
      <XUnitPackageOutputDirectory>$(XUnitDirectory)bin/packages/$(Configuration)/</XUnitPackageOutputDirectory>
    </PropertyGroup>
  </Target>

  <Target Name="BuildXUnit" DependsOnTargets="_InitializeXUnit">
    <Exec Command="$(XUnitDirectory)build$(ShellExtension) -$(Configuration)"
          WorkingDirectory="$(XUnitDirectory)" />

    <ItemGroup>
      <StandardPackages Include="$(XUnitPackageOutputDirectory)*.nupkg" />
    </ItemGroup>

    <Copy SourceFiles="@(XUnitPackages)"
          DestinationFolder="$(XUnitBuiltPackagesPath)" />

    <WriteVersionsFile NugetPackages="@(XUnitPackages)"
                       OutputPath="%(XUnit.VersionFile)" />

    <Message Importance="Normal" Text="Wrote %(XUnit.Identity) VersionsFile: %(XUnit.VersionFile)" />
  </Target>

  <!-- no-op right now as dotnet/standard doesn't have clean.sh -->
  <Target Name="CleanStandard" />
</Project>
