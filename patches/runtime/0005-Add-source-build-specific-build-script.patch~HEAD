From 405de3bac3020a85cca3a3029f9e4e129544e950 Mon Sep 17 00:00:00 2001
From: dseefeld <dseefeld@microsoft.com>
Date: Wed, 15 Jan 2020 15:14:54 +0000
Subject: [PATCH] Add source-build specific build script

---
 build-source-build.sh | 70 +++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 70 insertions(+)
 create mode 100755 build-source-build.sh

diff --git a/build-source-build.sh b/build-source-build.sh
new file mode 100755
index 0000000..229ae10
--- /dev/null
+++ b/build-source-build.sh
@@ -0,0 +1,70 @@
+#!/usr/bin/env bash
+
+source="${BASH_SOURCE[0]}"
+
+# resolve $SOURCE until the file is no longer a symlink
+while [[ -h $source ]]; do
+  scriptroot="$( cd -P "$( dirname "$source" )" && pwd )"
+  source="$(readlink "$source")"
+
+  # if $source was a relative symlink, we need to resolve it relative to the path where the
+  # symlink file was located
+  [[ $source != /* ]] && source="$scriptroot/$source"
+done
+
+scriptroot="$( cd -P "$( dirname "$source" )" && pwd )"
+
+capture="common"
+
+for arg do
+  shift
+  opt="$(echo "$arg" | awk '{print tolower($0)}')"
+  case $opt in
+    (--coreclr-args)
+            capture="coreclr"
+            arg=""
+            ;;
+    (--libraries-args)
+            capture="libraries"
+            arg=""
+            ;;
+    (--installer-args)
+            capture="installer"
+            arg=""
+            ;;
+       (*) ;;
+  esac
+
+  if [ "$arg" != "" ]; then
+      case $capture in
+        (common)
+            commonArgs="$commonArgs $arg"
+            ;;
+        (coreclr)
+            coreclrArgs="$coreclrArgs $arg"
+            ;;
+        (libraries)
+            librariesArgs="$librariesArgs $arg"
+            ;;
+        (installer)
+            installerArgs="$installerArgs $arg"
+            ;;
+        (*) ;;
+      esac
+  fi
+done
+
+echo "commonArgs = [$commonArgs]"
+echo "coreclrArgs = [$coreclrArgs]"
+echo "librariesArgs = [$librariesArgs]"
+echo "installerArgs = [$installerArgs]"
+
+echo "Running command: $scriptroot/build.sh $commonArgs -subsetcategory coreclr -subset runtime-corelib-nativecorelib-packages $coreclrArgs"
+$scriptroot/build.sh $commonArgs -subsetcategory coreclr -subset runtime-corelib-nativecorelib-packages $coreclrArgs
+find $scriptroot/artifacts/ -type f -name Build.binlog -exec rename "Build.binlog" "coreclrBuild.binlog" * {} \;
+#echo "Running command: $scriptroot/build.sh $commonArgs -subsetcategory libraries -subset all $librariesArgs"
+#$scriptroot/build.sh $commonArgs -subsetcategory libraries $librariesArgs
+#find $scriptroot/artifacts/ -type f -name Build.binlog -exec rename "Build.binlog" "librariesBuild.binlog" * {} \;
+#$scriptroot/build.sh $commonArgs -subsetcategory installer -subset corehost-managed-depproj-pkgproj-bundle $installerArgs
+#echo "Running command: $scriptroot/build.sh $commonArgs -subsetcategory installer -subset corehost-managed-depproj-pkgproj-bundle $installerArgs"
+#find $scriptroot/artifacts/ -type f -name Build.binlog -exec rename "Build.binlog" "installerBuild.binlog" * {} \;
-- 
1.8.3.1

