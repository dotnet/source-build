From 4d21b5f3e8097cfcc73c1363a4532ebfa34f3594 Mon Sep 17 00:00:00 2001
From: adaggarwal <aditya.aggarwal@microsoft.com>
Date: Wed, 20 Nov 2019 22:31:11 +0000
Subject: [PATCH] Do not build NET Fx binaries in source build

---
 eng/Versions.props         | 2 +-
 eng/targets/Settings.props | 4 +++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/eng/Versions.props b/eng/Versions.props
index f22a52d..daccf43 100644
--- a/eng/Versions.props
+++ b/eng/Versions.props
@@ -312,7 +312,7 @@
     <UsingToolSymbolUploader>true</UsingToolSymbolUploader>
     <UsingToolNuGetRepack>true</UsingToolNuGetRepack>
     <UsingToolVSSDK>true</UsingToolVSSDK>
-    <UsingToolNetFrameworkReferenceAssemblies>true</UsingToolNetFrameworkReferenceAssemblies>
+    <UsingToolNetFrameworkReferenceAssemblies Condition="'$(DotNetBuildFromSource)' != 'true'">true</UsingToolNetFrameworkReferenceAssemblies>
     <UsingToolIbcOptimization>true</UsingToolIbcOptimization>
     <UsingToolVisualStudioIbcTraining>true</UsingToolVisualStudioIbcTraining>
     <UsingToolXliff>true</UsingToolXliff>
diff --git a/eng/targets/Settings.props b/eng/targets/Settings.props
index 0e404bc..ae2f39c 100644
--- a/eng/targets/Settings.props
+++ b/eng/targets/Settings.props
@@ -16,7 +16,9 @@
     <!-- Disable the implicit nuget fallback folder as it makes it hard to locate and copy ref assemblies to the test output folder -->
     <DisableImplicitNuGetFallbackFolder>true</DisableImplicitNuGetFallbackFolder>
     <ToolsetPackagesDir>$(RepoRoot)build\ToolsetPackages\</ToolsetPackagesDir>
-    <RoslynPortableTargetFrameworks>netcoreapp3.1;net472</RoslynPortableTargetFrameworks>
+
+    <RoslynPortableTargetFrameworks>netcoreapp3.1</RoslynPortableTargetFrameworks>
+    <RoslynPortableTargetFrameworks Condition="'$(DotNetBuildFromSource)' != 'true'">$(RoslynPortableTargetFrameworks);net472</RoslynPortableTargetFrameworks>
     <RoslynCheckCodeStyle Condition="'$(ContinuousIntegrationBuild)' != 'true' or '$(RoslynEnforceCodeStyle)' == 'true'">true</RoslynCheckCodeStyle>
     <UseSharedCompilation>true</UseSharedCompilation>
 
-- 
1.8.3.1

