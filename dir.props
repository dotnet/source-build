<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <Configuration Condition="$(Configuration) == ''">Release</Configuration>
    <Platform Condition="'$(Platform)' == ''">x64</Platform>

    <!-- true if we have bootstrapped buildtools (usually on an unsupported platform -->
    <_IsBootstrapping Condition="'$(BootstrapBuildToolsDir)' != ''">true</_IsBootstrapping>
  </PropertyGroup>

  <PropertyGroup>
    <ProjectDir>$(MSBuildThisFileDirectory)</ProjectDir>
    <TargetsDir>$(ProjectDir)targets/</TargetsDir>
    <KeysDir>$(ProjectDir)keys/</KeysDir>
    <DotNetCliToolDir>$(ProjectDir)Tools/dotnetcli/</DotNetCliToolDir>
    <PreBuiltSourcesDir>$(ProjectDir)prebuilt/</PreBuiltSourcesDir>
	<PreBuiltMsBuildDotnetCliDir>$(MSBuildThisFileDirectory)/Tools/dotnetcli/</PreBuiltMsBuildDotnetCliDir>
	<PreBuiltPJDotnetCliDir>$(MSBuildThisFileDirectory)/Tools/pjdotnetcli/</PreBuiltPJDotnetCliDir>
    <PreBuiltDotnetCliDir>$(PreBuiltMsBuildDotnetCliDir)</PreBuiltDotnetCliDir>
    <PackagesDir>$(PreBuiltSourcesDir)packages/</PackagesDir>
    <OverrideBuildScriptsDir>$(ProjectDir)overridebuildscripts/</OverrideBuildScriptsDir>
  </PropertyGroup>

  <PropertyGroup>
    <ToolsDirOverride>(set TOOLRUNTIME_DIR=$(PreBuiltSourcesDir)$(RepositoryName)) &amp; </ToolsDirOverride>
    <PackagesOverride>(set NUGET_PACKAGES=$(PackagesDir)) &amp; (set PACKAGES_DIR=$(PackagesDir)) &amp; </PackagesOverride>
    <DotnetInstallOverride>(set DOTNET_INSTALL_DIR=$(PreBuiltDotnetCliDir)) &amp; </DotnetInstallOverride>
    <PackagesOverride Condition="'$(TargetOS)' != 'Windows_NT'">PACKAGES_DIR=$(PackagesDir) NUGET_PACKAGES=$(PackagesDir)</PackagesOverride>
    <DotnetInstallOverride Condition="'$(TargetOS)' != 'Windows_NT'">DOTNET_INSTALL_DIR=$(PreBuiltDotnetCliDir) </DotnetInstallOverride>
    <DotnetToolsetInstallOverride Condition="'$(TargetOS)' != 'Windows_NT'">DOTNET_TOOLSET_DIR=$(PreBuiltDotnetCliDir) </DotnetToolsetInstallOverride>
    <BuildToolsetInstallOverride Condition="'$(TargetOS)' != 'Windows_NT'">BUILD_TOOLS_TOOLSET_DIR=$(PackagesDir)/microsoft.dotnet.buildtools </BuildToolsetInstallOverride >
  </PropertyGroup>

  <PropertyGroup>
    <NugetConfigFile>$(ProjectDir)Nuget.config.template</NugetConfigFile>
    <IsOnlineBuild>true</IsOnlineBuild>
  </PropertyGroup>

  <PropertyGroup>
    <BuildInParallel Condition="'$(BuildInParallel)'==''">false</BuildInParallel>
  </PropertyGroup>

  <PropertyGroup>
    <CommandSeparator Condition="'$(OS)' == 'Windows_NT'">&amp;</CommandSeparator>
    <CommandSeparator Condition="'$(OS)' != 'Windows_NT'">%3B</CommandSeparator>
    <ShellExtension Condition="'$(OS)' == 'Windows_NT'">.cmd</ShellExtension>
    <ShellExtension Condition="'$(OS)' != 'Windows_NT'">.sh</ShellExtension>
    <TarBallExtension Condition="'$(OS)' == 'Windows_NT'">.zip</TarBallExtension>
    <TarBallExtension Condition="'$(OS)' != 'Windows_NT'">.tar.gz</TarBallExtension>
  </PropertyGroup>

  <PropertyGroup>
    <SubmoduleDirectory Condition="'$(SubmoduleDirectory)' == ''">$(ProjectDir)src/</SubmoduleDirectory>
    <ProjectDirectory Condition="'$(ProjectDirectory)' == ''">$(SubmoduleDirectory)$(RepositoryName)/</ProjectDirectory>
  </PropertyGroup>

  <PropertyGroup>
    <BaseOutputPath>$(ProjectDir)bin/</BaseOutputPath>
    <ToolsDir>$(ProjectDir)Tools/</ToolsDir>
    <TaskDirectory>$(ProjectDir)tasks/</TaskDirectory>
    <TasksBinDir>$(TaskDirectory)Microsoft.DotNet.SourceBuild.Tasks/bin/Debug/netstandard1.5/</TasksBinDir>
    <BaseIntermediatePath>$(BaseOutputPath)obj/</BaseIntermediatePath>
    <OutputPath>$(BaseOutputPath)$(Platform)/$(Configuration)/</OutputPath>
    <IntermediatePath>$(BaseIntermediatePath)$(Platform)/$(Configuration)/</IntermediatePath>
    <LocalBlobStorageRoot>$(IntermediatePath)blobs/</LocalBlobStorageRoot>
    <LocalBuildInfoRoot>$(IntermediatePath)build-info/</LocalBuildInfoRoot>
    <SourceBuiltPackagesPath>$(OutputPath)packages/source-built/</SourceBuiltPackagesPath>
    <SourceBuiltSymbolsPackagesPath>$(SourceBuiltPackagesPath)symbols/</SourceBuiltSymbolsPackagesPath>
    <RepositoryOrganization Condition="'$(RepostioryOrganization)' == ''">dotnet</RepositoryOrganization>
    <RepositoryBranch Condition="'$(RepositoryBranch)' == ''">master</RepositoryBranch>
    <TargetInfoProps>$(IntermediatePath)TargetInfo.props</TargetInfoProps>
    <WrapperProjectsDirectory>$(TargetsDir)wrapper-projects/</WrapperProjectsDirectory>
  </PropertyGroup>

  <Import Project="$(TargetInfoProps)" Condition="$(GeneratingStaticPropertiesFile) != 'true'" />

  <PropertyGroup>
    <TarballName>dotnet-source-build</TarballName>
    <VersionFilename>Latest_Packages.txt</VersionFilename>
    <VersionFileDirectory>$(LocalBuildInfoRoot)</VersionFileDirectory>
    <VersionFileLocation Condition="'$(VersionFileLocation)' == ''">$(VersionFileDirectory)$(RepositoryOrganization)/$(RepositoryName)/$(RepositoryBranch)/$(VersionFilename)</VersionFileLocation>
  </PropertyGroup>

  <PropertyGroup>
    <DefaultRepository>cli</DefaultRepository>
  </PropertyGroup>

  <ItemGroup>
    <SourceBuiltPackage Include="$(SourceBuiltPackagesPath)/*.nupkg" />
  </ItemGroup>

  <Import Project="repositories.props" />
</Project>
